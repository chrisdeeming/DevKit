!function(l,r,s,t){XenForo.AdvancedTextArea=function(h){this.__construct(h)};XenForo.AdvancedTextArea.prototype={__construct:function(h){this.textarea=h;this.initialize()},initialize:function(){var h=function(a,c){var b=a[0],d=a.data("undoStack");d||(d=[]);d.push([a.val(),b.selectionStart,b.selectionEnd]);a.data("undoStack",d);c&&a.data("redoStack",[])},n=function(a){var c=a[0];a.data("undoStack");var b=a.data("redoStack");b&&b.length&&(h(a,!1),b=b.pop(),a.val(b[0]),c.selectionStart=b[1],c.selectionEnd=
b[2],a.data("lastSelPosition",b[2]))},p=function(a){var c=a.data("lastSelPosition"),b=!1;"undefined"==typeof c||isNaN(c)||a[0].selectionEnd==c||(h(a,!0),b=!0);setTimeout(function(){a.data("lastSelPosition",a[0].selectionEnd)},0);return b},q=this;this.textarea.on("keypress",function(a){p(l(this))});this.textarea.on("keydown",function(a){var c=l(this);c.data("undoStack")||c.data("undoStack",[[c.val(),0,0]]);13==a.keyCode&&h(c,!0);if(90==a.keyCode&&(a.metaKey||a.ctrlKey))if(a.preventDefault(),a.shiftKey)n(c);
else{a=c[0];var b=c.data("undoStack"),d=c.data("redoStack");d||(d=[]);d.push([c.val(),a.selectionStart,a.selectionEnd]);c.data("redoStack",d);b&&b.length&&(b=b.pop(),c.val(b[0]),a.selectionStart=b[1],a.selectionEnd=b[2],c.data("lastSelPosition",b[2]))}else if(89==a.keyCode&&(a.metaKey||a.ctrlKey))a.preventDefault(),n(c);else if(9==a.keyCode&&!a.metaKey&&!a.ctrlKey&&!a.altKey){a.preventDefault();var b=this.selectionStart,e=this.selectionEnd,f=c.val(),d=f.substring(0,b),m=f.substring(e),k=!0;if(b!=
e&&(e=f.substring(b,e),-1!=e.indexOf("\n"))){var k=!1,f=0,g=d.lastIndexOf("\n");-1==g?(e=d+e,f=d.length,d=""):(e=d.substring(g)+e,f=d.length-g,d=d.substring(0,g));a.shiftKey?(g=/(\n|^)(\t|[ ]{1,8})/g,e.match(g)&&(b-=1,f--),e=e.replace(g,"$1")):(e=e.replace(/(\n|^)/g,"$1\t"),b+=1,f++);h(c,!0);c.val(d+e+m);this.selectionStart=b;this.selectionEnd=b+e.length-f}k&&!a.shiftKey&&(c.val(d+"\t"+m),this.selectionStart=this.selectionEnd=b+1)}else if(13!=a.keyCode||a.metaKey||a.ctrlKey||a.altKey||a.shiftKey)83==
a.keyCode&&(a.ctrlKey||a.metaKey)&&(a.preventDefault(),q.$saveReloadButton.click());else if(b=this.selectionStart,e=this.selectionEnd,f=c.val(),d=f.substring(0,b),m=f.substring(e),g=d.lastIndexOf("\n"),k=(-1==g?d:d.substring(g+1)).match(/^(\s+)/))a.preventDefault(),c.val(d+"\n"+k[1]+m),this.selectionStart=this.selectionEnd=b+k[1].length+1});this.textarea.on("cut paste",".textCtrl.code",function(){p(l(this))||h(l(this),!0)})}};XenForo.register(".AdvancedTextArea","XenForo.AdvancedTextArea")}(jQuery,
this,document);
